\documentclass[./main.tex]{subfiles}
\begin{document}

\begin{subsection}{The Local Connectivity ATSP Problem}
	Fix some function $\lb : 2^V\rightarrow \mathbb{R}^+$ that obeys the following properties:
	\begin{enumerate}
		\item $\lb(S) = \sum\limits_{v\in S}\lb(\{v\})$ for all $S\subseteq V$
		\item $\lb(V) = \val(I)$
	\end{enumerate}
	One can think of \lb\ as being defined by distributing the LP value among the vertices in some way.\vspace{3mm}
	\begin{problem}
	\ \\Input: $I$ (the instance) and $V_1,\ldots,V_k$ (a partitioning of $V$) such that $V_i$ is strongly connected.
	\\Output: $F$, an eulerian set of edges such that for every $i$, $F$ exits (and hence enters) $V_i$ at least once.\end{problem}\vspace{4mm}
	\begin{definition}
		An algorithm for local connectivity ATSP is called $\bm{\alpha}$\textbf{-light} if it outputs $F$ such that for each strongly connected component of $F$, say $\tilde{G}$, $w(\tilde{G})\leq \alpha\cdot \lb(\tilde{G})$.
	\end{definition}\vspace{2mm}
	\begin{theorem}[Svensson '15] An $\alpha$-light algorithm for local connectivity ATSP implies a $O(\alpha)$-approximation algorithm for ATSP.
	\end{theorem}
	The paper describes an $O(1)$-light algorithm for local connectivity on vertebrate pairs, which gives us an $O(1)$-approximation algorithm for ATSP on vertebrate pairs, and hence an $O(1)$-approximation algorithm for general ATSP.\vspace{2mm}
	\\We will also assume that $w(B)\leq O(1)\cdot \val(I)$, since in the previous reduction, this inequality is always true.
	\begin{definition}
		For this algorithm, we will define \lb\ as $$\textbf{\lb(v)}:=
		\begin{cases}
			\dfrac{\val(I)}{|V(B)|}\quad \text{if }v\in B \\
			2\cdot y_v\quad \text{otherwise}
		\end{cases}$$
	\end{definition}
	Note that this definition does not guarantee that $\lb(V) = \val(I)$, but $\lb(V)$ is always a constant factor away from $\val(I)$, so we can work with these \lb\ values and suffer a constant factor loss in the approximation ratio.\vspace{2mm}
	\end{subsection}
	\\To make corner cases easier, we add $V$ to $L_{\geq 2}$ for the rest of this write up.\vspace{2mm}
	\\The following is the main technical lemma of the paper. \vspace{1mm}
	\begin{lemma}[Lemma 7.3 in the paper]\label{lemma7}
		Given $U_1,\ldots,U_l$ disjoint subsets of $V\setminus V(B)$ that are strongly connected in $G$, such that for each $S\in L_{\geq 2}$, either $U_i\in S$ or $U_i$ is disjoint from $S$, we can find eulerian $F\subseteq E$ such that:
		\begin{enumerate}
			\item[(1)] $w(F)\leq 3\cdot \val(I)$
			\item[(2)] $|\delta^-_F(U_i)|\geq 1$ for all $i$
			\item[(3)] $|\delta^-_F(v)|\leq 4$ for all $v$ such that $x(\delta^-(v)) = 1$
			\item[(4)] Any subtour in $F$ that crosses a set in $L_{\geq 2}$ visits a vertex of the backbone
		\end{enumerate}
	\end{lemma}\vspace{2mm}
	We will use the lemma to prove the following theorem, and prove the lemma later on.\vspace{2mm}\pagebreak[2]
	\begin{theorem}
		There is an $O(1)$-light algorithm for local connectivity ATSP on vertebrate pairs.
	\end{theorem}
	\begin{proof}
		We receive $(I,B)$ and $V_1,\ldots,V_k$ as input. We output $F^*=B\cup P\cup F$, where $P$ and $F$ are defined as:
		\begin{enumerate}
			\item[$P$:] If $B$ exists entirely within some $V_i$, then we pick $u\in B$ and $v\notin V_i$, and set $P$ to be the shortest cycle containing $u$ and $v$. Otherwise we keep $P$ empty.
			\item[$F$:] WLOG, let $V_1,\ldots,V_l$ be the partitions that are disjoint from $B$. Now let $V_i'$ be the intersection of $V_i$ with a minimal set in $L_{\geq 2}$ that $V_i$ intersects. Let $U_i$ be the first strongly connected component of $V_i'$ (in the topological order). Set $F$ to be the eulerian set guaranteed by running the algorithm of \hyperref[lemma7]{Lemma \ref{lemma7}} on $U_1,\ldots,U_l$.
		\end{enumerate}\vspace{2mm}
		Now we need to verify that $B\cup P\cup F$ is feasible, and that it is $O(1)$-light.
		\\For each $V_i$, there are three possibilities:
		\begin{enumerate}
			\item[(a)] $V_i$ completely contains the backbone. The set $P$ guarantees that $F^*$ enters $V_i$ at least once.
			\item[(b)] $V_i$ partially contains the backbone. In this case, $B$ trivially crosses $V_i$, so $F^*$ must enter $V_i$.
			\item[(c)] $V_i$ is disjoint from the backbone. In this case, (2) tells us that some edge $(u,v)$ must enter $U_i$. $u\notin V_i'$ since $U_i$ is the source component of $V_i'$. So either $u\in S\setminus V_i$ or $u\notin S$. If the former is true, then $(u,v)$ enters $V_i$ from outside. If the latter is true, then $(u,v)$ crosses $S$, and guarantee $(4)$ of \hyperref[lemma7]{Lemma \ref{lemma7}} tells us that the subtour containing $(u,v)$ visits the backbone, which is outside $V_i$.
		\end{enumerate}
		In any case, $F^*$ crosses each $V_i$, so it is indeed feasible.\vspace{2mm}
		\\Now consider any strongly connected component of $F^*$, say $\tilde{G}$. We would like to bound $w(\tilde(G))$ by $O(\lb(\tilde{G}))$. There are two possibilities for $\tilde{G}$:
		\begin{enumerate}
			\item[(a)] $\tilde{G}$ contains the backbone. So $$w(\tilde{G})\leq w(B) + w(P) + w(F)\leq O(\val(I)) + \val(I) + 3\cdot\val(I) = O(\val(I))$$
			      $$\lb(\tilde{G})\geq \lb(V(B)) = \val(I)$$
			      And it follows that $w(\tilde{G})\leq O(\lb(\tilde{G}))$.
			\item[(b)] $\tilde{G}$ is disjoint from the backbone. In this case, $(4)$ guarantees that $\tilde{G}$ did not cross any set in $L_{\geq 2}$, so the only sets it might have crossed are singletons. Additionally, $(3)$ guarantees that it crosses each singleton at most four times. $$w(\tilde{G})\leq \sum_{v\in V(\tilde{G})}4\cdot 2\cdot y_v = 4\cdot\lb(\tilde{G})$$
		\end{enumerate}
	\end{proof}
	\begin{subsection}{Proof of \hyperref[lemma7]{Lemma \ref{lemma7}}: The final ingredient}

		Order the laminar sets in $L_{\geq 2}$ by size so that $|S_1|\leq |S_2|\leq\cdots\leq |S_l| = |V|$. For each $v\in V$, define $level(v)$ to be the index of the smallest set it is contained in.\vspace{2mm}
		\begin{definition}
			An edge $e$ is called a \textbf{forward edge}, \textbf{backward edge}, or \textbf{neutral edge} if $e\in E_f$, $e\in E_b$, or $e\in E_n$ respectively, where $E_f, E_b,$ and $E_n$ are defined as:
			\begin{enumerate}[$-$]
				\item $\bm{E_f}:=\{(u,v)\in E\mid level(u) > level(v)\}$
				\item $\bm{E_b}:=\{u,v)\in E\mid level(u) < level(v)\}$
				\item $\bm{E_n}:=E\setminus (E_f\cup E_b)$
			\end{enumerate}
		\end{definition}
		\vspace{2mm}\pagebreak[2]
		\begin{definition}
			Call $\bm{G_{sp}}$ the \textbf{split graph}, where we define it as follows: for each $v\in V$, create $v^0$ and $v^1$ in $V(G_{sp})$. Create the following edges along with weights $\bm{w_{sp}}$:
			\begin{itemize}[$-$]
				\item $(v^0, v^1)$ for all $v\in V$ with weight $0$. Call these edges $0-1$ edges.
				\item $(v^1, v^0)$ for all $v\in V(B)$ with weight $0$. Call these edges $1-0$ edges.
				\item $(u^1, v^1)$ for all $(u,v)\in E_f\cup E_n$ with weight $w(u,v)$. Call these edges $1-1$ edges.
				\item $(u^0, v^0)$ for all $(u,v)\in E_b\cup E_n$ with weight $w(u,v)$. Call these edges $0-0$ edges.
			\end{itemize}
			Also for any set $S\subseteq V$, let $S^{sp}$ be its image in $G_{sp}$.
		\end{definition}\vspace{2mm}
		Consider the lift of some subtour in $G_{sp}$ that crosses at least one set in $L_{\geq 2}$. Let $S$ be the smallest set in $L_{\geq 2}$ that the subtour crosses. 
		Then the edge of the subtour going into $S$ must be a forward edge (i.e. a $1-1$ edge) by definition, and the edge going out of $S$ must be a backward edge (i.e. a $0-0$ edge). This means at some point, the subtour must use a $1-0$ edge, which it can only do if it crosses the backbone.\vspace{1mm}
		\\So if we restrict ourself to lifts of subtours of $G_{sp}$ (instead of all subtours of $G$), guarantee (4) will always be true.\vspace{2mm}
		\begin{lemma}
		\label{lemma6-1}		We can find $x_{sp}$, an eulerian vector on $G_{sp}$ that the image of $x_{sp}$ in $G$ is $x$.
		\end{lemma}
		\begin{proof}
		If we want the image of $x_{sp}$ to be $x$, we must necessarily have the following conditions:
		\begin{itemize}
			\item[(a)] $x_{sp}(u^0,v^0) = 0$, for all $(u,v)\in E_f$, since there is no $(u^0,v^0)$ edge in $G_{sp}$.
			\item[(b)] $x_{sp}(u^1,v^1) = 0$, for all $(u,v)\in E_b$, since there is no $(u^1,v^1)$ edge in $G_{sp}$.
			\item[(c)] $x_{sp}(u^0,v^0)+x_{sp}(u^1,v^1) = x(u,v)$ for all $(u,v)\in E$, since the image of $x_{sp}$ in $G$ must be $x$.
		\end{itemize}
\vspace{2mm}
After defining some $x_{sp}$ values on the $0-0$ and $1-1$ edges, there will be some "potential" on each vertex (i.e. the net outgoing flow), and since $x$ was eulerian, the potential of the $0$-copy of a vertex, say $v$, is exactly the negative potential of the $1$-copy.
		If the potential of the $1$-copy is positive, $v^0$ and $v^1$ can be brought down to zero potential by routing that amount of flow through $(v^0,v^1)$. 
		But if it is negative, this can only be equalized using a $(v^1,v^0)$ edge, which is impossible unless $v\in V(B)$. In other words, if we want $x_{sp}$ to be eulerian, it must also fulfil the following condition:
		\begin{itemize}
			\item[(d)] $x_{sp}(\delta^-(v_1)\setminus (v^0,v^1) )\geq x_{sp}(\delta^+(v_1)\setminus (v^0,v^1))$ for all $v\notin V(B)$.
		\end{itemize}

		It can easily be seen that (a), (b), (c), and (d) are also sufficient for some nonnegative $x_{sp}$ to fulfil the guarantees of Lemma \ref{lemma6-1}.
		 This gives rise to the following LP and its dual where $f$ can be interpreted as $x_{sp}$ restricted to $1-1$ edges:\vspace{2mm}\\
		\begin{minipage}{0.39\textwidth}
		\begin{align*}
			\max\quad\sum_{e\in E_f}&f(e)\\
			s.t.\quad f(\delta^+(v))&\geq f(\delta^-(v))   &v\notin V(B)              \\
			f(e)&=0  &e\in E_b\\
			0\leq f(e)&\leq x(e) &e\in E\\
		\end{align*}
		\end{minipage}
	\hfill\vline\hfill
	\begin{minipage}{0.50\textwidth}
	\begin{align*}
		\min\quad\sum_{e\in E_f\cup E_n}x(e)z(e)\\
		s.t.\quad \pi_v - \pi_u + z(u,v)&\geq 1 &(u,v)\in E_f\\
		\pi_v - \pi_u + z(u,v)&\geq 0 &(u,v)\in E_n\\
		\pi_v &= 0 &v\in V(B)\\
		\pi, z&\geq 0
	\end{align*}
	\end{minipage}

Once we have some primal feasible $f$, we can extend it by defining $x_{sp}$ as $f$ on $1-1$ edges, $x-f$ on $0-0$ edges, and eliminating potential differences between $0$ and $1$ copies using $0-1$ and $1-0$ edges. 
The first inequality of the LP guarantees (d) by definition. 
The second inequality guarantees (b) by definition. And the way we extend $f$ to $0-0$ edges guarantees (c). 
Now if we know that the primal optimal value is equal to $\sum_{e\in E_f}x_e$, then it guarantees (a) as well. The following claim proves this, so (a), (b), (c), and (d) must all hold.	\end{proof}
\vspace{2mm}
	\begin{claim}
		The primal optimal value is equal to $\sum_{e\in E_f}x_e$.
	\end{claim}
	\begin{proof}
		Note that if there were a dual optimal solution where $\pi = 0$, then the dual optimal (and hence primal optimal) value would be precisely $\sum_{e\in E_F}1\cdot x_e$. 
		So consider any dual optimal solution, say $(z,\pi)$. Our goal is to convert it into a dual optimal solution whose $\pi$ has strictly smaller support. 
		Running this procedure repeatedly proves that there is a dual optimal where $\pi = 0$.\vspace{2mm}
		\\Let $T$ be the set of vertices in support($\pi$) with the smallest level, and let $S$ be the set corresponding to that level.
		Also, let $F = \delta(V\setminus S, T)$, and $F' = \delta(T,S\setminus T)$.
		\\To start off, let's decrement the $\pi$-values of all vertices in $T$ by the smallest $\pi$-value of any vertex in $T$, say $\varepsilon$. Now $\pi$ has a smaller support, but it may not be feasible. In order to correct this, we increase $z(e)$ by $\varepsilon$ for all $e\in F$. Now the solution might not be optimal. In order to correct this, we decrease $z(e)$ by $\varepsilon$ for all $e\in F'$. In order to see why the new dual is feasible, note that an edge $(u,v)$ can be of the following types:
		\begin{itemize}
		\item[Case 1:] $v\notin T$. Since we only decreased the $\pi$-value of vertices in $T$ (and left all other vertices unchanged), the left hand side of each of the first two dual inequalities can only increase. So these inequalities are still satisfied.
		\item[Case 2:] $u,v\in T$. In this case, the decrease in $\pi_v$ is matched by the increase in $-\pi_u$, so the inequalities are still satisfied.
		\item[Case 3:] $u\notin S, v\in T$. In this case, the decrease in $\pi_v$ is matched by the increase in $z(u,v)$, so the inequalities are still satisfied.
		\item[Case 4:] $u\in S\setminus T, v\in T$. In this case, $(u,v)$ cannot be a forward edge, since if it were, then $T$ would intersect a set in $L_{\geq 2}$ which was smaller than $S$. But we defined $S$ to be the smallest such set. So we only consider the second inequality, which must be satisfied, since $\pi_u$ was already $0$ and $\pi_v$ is nonnegative.
		\end{itemize}
		The inequality $\pi\geq 0$ must be satisfied simply because we reduced $\pi_v$ for $v\in T$ by $\min_{u\in T}\pi_u$. 
		Also, since all edges $(u,v)$ in $F'$ are either neutral or forward, we originally satisfied $\pi_v - \pi_u + z(u,v)\geq 0$. Since $u\in T$ and $v\in S\setminus T$, we must have that $0 - \varepsilon + z(u,v)\geq 0$, that is, $z(u,v)\geq \varepsilon$. 
So the inequality $z\geq 0$ must be satisfied since we only reduced $z$-value in $F'$, and for all edges in $F'$, we already had $\varepsilon$ $z$-value to begin with.\vspace{2mm}
\\Now we will see that the new dual value is still optimal. 
The decrease in dual objective value was precisely $\varepsilon (x(F') - x(F\cap( E_f\cup E_n))\geq \varepsilon(x(F') - x(F))$. If we can show that this is positive, then the new dual value is still optimal. The proof relies on the fact that $S$ is either an original laminar set or $V$, so $x(\delta^-(S))\leq 1$. Now, $$1\leq x(\delta^-(S\setminus T)) = \underbrace{x(\delta^-(S)) - x(F)}_{\text{edges from outside } S} + \underbrace{x(F')}_{\text{edges from } T}\leq 1 - x(F) + x(F')$$
It follows that $x(F)\leq x(F')$, so the updated dual solution is still optimal, and there exists a dual optimal solution with $\pi = 0$.
	\end{proof}
	At this point, it can be shown that (with a few modifications) rounding $x_{sp}$ to an integral solution and taking its image in $G$ would fulfil conditions $(1)$, $(3)$, and $(4)$ of \hyperref[lemma7]{Lemma \ref{lemma7}}. To fulfil $(2)$, the split graph is further modified taking into account the $U_i$s.\vspace{2mm}
	\begin{definition}
		The modified split graph $\bm{G'_{sp}}$ is created by modifying $G_{sp}$ according to the following procedure for every $U_i$:
		\begin{itemize}[$-$]
		\item Add a new vertex called $a_i$.
		\item Pick $X_i^-$ to be a subset of incoming edges to $U_i^{sp}$ such that $x_{sp}(X_i^-) = 1/2$ and $X_i^-$ consists of either solely $1-1$ edges or solely $0-0$ edges. This must be possible since the total $x$-value coming into $U_i^{sp}$ is at least $1$.
		\item Let $X_i^+$ be a subset of edges leaving $U_i^{sp}$ that entered through some edge in $X_i^-$. This can be found using a path decomposition of $x_{sp}$ on $U_i$ and following each edge of $X_i^-$ along its paths. Then $x_{sp}(X_i^+) = 1/2$.
		\item Redirect every edge in $X_i^-$ to $a_i$, and every edge in $X_i^+$ from $a_i$. In other words, $(u,v)\in X_i^-$ becomes $(u,a_i)$ and $(u,v)\in X_i^+$ becomes $(a_i, v)$. Also for each $u-v$ path we considered in the path decomposition (where $u\in X_i^-, v\in X_i^+$), reroute the $x_{sp}$ flow to the path $(u,a_i),(a_i,v)$. Call this modified flow $x'_{sp}$. Note that $x_{sp}'$ is still a circulation, and the original paths we considered are effectively deleted in $G'_{sp}$.
		\end{itemize}
	\end{definition}
		
	\end{subsection}

\end{document}
